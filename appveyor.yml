version: 1.1.{build}

skip_commits:
  message: /readme.*|doc.*/

only_commits:
  files:
    - xpoTools/
    - xpoTools.nuspec

init:
- ps: >-
    $PSVersionTable
    [System.Environment]::OSVersion

install:
- ps: >-
    Install-PackageProvider -Name NuGet -Force | Out-Null
    Install-Module -Name Pester -Force
    Install-Module -Name PSScriptAnalyzer -Force
    Install-Module -Name SplitPipeline -Force

build_script:
- ps: >-
    $ModuleName = 'xpoTools'
    $ModuleRoot = Join-Path ([Environment]::GetFolderPath('MyDocuments')) WindowsPowerShell\Modules\$ModuleName
    Copy-Item $ModuleName $ModuleRoot -Recurse

test_script:
- ps: >-
    $res = Invoke-Pester -OutputFormat NUnitXml -OutputFile TestsResults.xml -PassThru
    $destination = "https://ci.appveyor.com/api/testresults/nunit/$($env:APPVEYOR_JOB_ID)"
    (New-Object 'System.Net.WebClient').UploadFile($destination, (Resolve-Path .\TestsResults.xml))
    if ($res.FailedCount -gt 0) { throw "$($res.FailedCount) tests failed."}